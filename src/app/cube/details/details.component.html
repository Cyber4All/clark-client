<app-dialogmenu [content]="modalService.dialogMenuContent"></app-dialogmenu>
<main id='pageContent' class='details-background'>
  <div class='details'>
    <div class='details__content-container'>
      <section class='details__content-container__splash-container'>
        <clark-details-splash [learningObject]='learningObject' [averageRating]='averageRatingValue' [reviewsCount]='ratings?.length'></clark-details-splash>
      </section>
      <section class='details__content-container__action-pad-container'>
        <clark-action-pad></clark-action-pad>
      </section>
      <section class='details__content-container__right-side-container'>
        <h2 class='section-title'>Authors</h2>
        <div class='content-container__profile-cards-container-profile-card' *ngFor='let author of learningObject.contributors'>
          <clark-author-card [author]=author [profileImageURL]=getGravatar(author)></clark-author-card>
        </div>
        <div class='details__content-container__version-card-container'>
          <clark-version-card [showButton]='loggedin && auth.user.emailVerified' (clickButtonEvent)='openViewAllChangelogsModal()'></clark-version-card>
        </div>
      </section>
      <section class='details__content-container__description-container'>
        <h2 class='section-title'>Description</h2>
        <clark-details-description [description]='learningObject.description'></clark-details-description>
      </section>
      <section class='details__content-container__learning-outcomes-container'>
        <h2 class='section-title'>Learning Outcomes</h2>
        <div *ngFor='let outcome of learningObject.outcomes'>
          <clark-outcome [outcome]=outcome></clark-outcome>
        </div>
      </section>
      <section class='details__content-container__academic-levels-container'>
        <h2 class='section-title'>Academic Levels</h2>
        <div class='content-container__academic-levels-container__card-grid'>
          <div *ngFor='let data of academicLevelMetadata'>
            <clark-academic-level-card [category]=data.category [academicLevels]=data.academicLevels></clark-academic-level-card>
          </div>
        </div>
      </section>
      <section class='details__content-container__materials-container'>
        <h2 class='section-title'>Materials</h2>
        <clark-materials [materials]='learningObject.materials'></clark-materials>
      </section>
      <section class='details__content-container__ratings-container'>
        <div class='details__content-container__ratings-container__header-container'>
          <h2 class='section-title'>Reviews</h2>
          <div>
            <button 
              tabindex="0" 
              *ngIf="!isMobile && loggedin && !isOwnObject"
              tip="You must verify your email in order to review Learning Objects."
              [tipDisabled]="auth.user.emailVerified"
              class="button good content-container__ratings-container__button-container"
              (activate)="showAddRating = auth.user.emailVerified"
              attr.aria-label="Clickable button {{ userRating.date ? 'Edit your' : 'Write a'}} review">{{ userRating.date ? 'Edit your' :
              'Write a'}} review 
              <i class="far fa-pencil"></i>
            </button>
          </div>
        </div>
        <clark-learning-object-ratings 
          [ratings]="ratings"
          [averageRating]="averageRatingValue"
          [learningObjectOwners]="learningObjectOwners"
          [loggedIn]="loggedin" 
          (editRating)="showAddRating = true;"
          (deleteRating)="deleteRating($event)"
          (editResponse)="editResponse($event);"
          (deleteResponse)="deleteResponse($event)"
          (reportRating)="reportRating($event)"
          (respondRating)="submitResponse($event)">
        </clark-learning-object-ratings>   
      </section>
    </div>
  </div>
</main>
<div *ngIf="loggedin && !errorStatus" class="new-rating-wrapper" [ngClass]="{'active': showAddRating}" (activate)="showAddRating = false;">
  <div class="new-rating" (activate)="$event.stopPropagation()">
    <div class="close-new-rating" (activate)="showAddRating = false;"><i class="far fa-times"></i></div>
    <div class="title">Rate this Learning Object</div>
    <clark-new-rating [rating]="userRating" [editing]="userRating.date ? true : false" (setRating)="handleRatingSubmission($event)"
      (cancelRating)="showAddRating = false;"></clark-new-rating>
  </div>
</div>

<clark-popup [floating]="true" *ngIf="openChangelogModal" (closed)="closeChangelogsModal()">
    <div #popupInner style="min-width: 500px; max-width: 650px;" class="popup-inner">
      <clark-changelog-modal
        [learningObject] = "learningObject"
        [changelogs] = "changelogs ? changelogs[0] : undefined"
        [loading]="loadingChangelogs"
      ></clark-changelog-modal>
    </div> 
</clark-popup>
