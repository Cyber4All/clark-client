<div class="dashboard-list">
  <div class="dashboard-list__top">
    <p class="dashboard-list__title" tabindex="0">
      {{ title || 'Learning Objects' }} 
      <span *ngIf="learningObjects; else noLearningObjects"> ({{ learningObjects.length }})</span>
    </p>
    <div *ngIf="showOptions; else buttonPlaceholderTemplate" class="dashboard-list__options">
      <div class="btn-group to-right">
        <button aria-label="Create a new Learning Object" class="button good">New <i class="far fa-plus"></i></button>
        <button #filterMenuButtonElement aria-label="Filter Learning Objects by status" class="button neutral" (click)="toggleFilterMenu(true)">Filter <i class="far fa-angle-down"></i></button>
        <button *ngIf="selected.size" class="button bad" (click)="deleteConfirmation = delete(getSelectedObjects()); deleteConfirmation.next()">Delete Selected <i class="far fa-trash"></i></button>
        <button *ngIf="filters.size > 0" aria-label="Clear all selected filters" class="button bad" (click)="clearFilters()">Clear Filters<i class="far fa-times"></i></button>
      </div>
      <ng-container>
        <!-- Filter Context Menu -->
        <clark-context-menu *ngIf="filterMenuDown" [anchor]="filterMenuButtonElement" [offset]="{ top: 10, left: 5 }" (close)="toggleFilterMenu()">
          <div #contextMenu class="filter-menu">
            <ul>
              <li class="unreleased" (click)="toggleFilter('unreleased')">
                <div *ngIf="filters.get('unreleased')" class="indicator"></div>
                <i class="far fa-eye-slash"></i>Unreleased
              </li>
              <li class="waiting" (click)="toggleFilter('waiting')">
                <div *ngIf="filters.get('waiting')" class="indicator"></div>
                <i class="far fa-hourglass"></i>Waiting for Review
              </li>
              <li class="review" (click)="toggleFilter('review')">
                <div *ngIf="filters.get('review')" class="indicator"></div>
                <i class="far fa-sync"></i>Under Review
              </li>
              <li class="proofing" (click)="toggleFilter('proofing')">
                <div *ngIf="filters.get('proofing')" class="indicator"></div>
                <i class="far fa-shield"></i>Proofing
              </li>
              <li class="denied" (click)="toggleFilter('rejected')">
                <div *ngIf="filters.get('rejected')" class="indicator"></div>
                <i class="far fa-ban"></i>Denied
              </li>
            </ul>
          </div>
        </clark-context-menu>
      </ng-container>
    </div>
    <ng-template #buttonPlaceholderTemplate>
      <div style="height: 40px;"></div>
    </ng-template>
  </div>
  <div role="table" *ngIf="!loading; else loadingTemplate" class="list-body">
      <div *ngIf="learningObjects?.length; else noLearningObjects">
        <div role="row" class="column-headers">
          <div>
            <clark-checkbox *ngIf="showOptions" role="button" aria-label="Select all Learning Objects" [value]="areAllSelected" (action)="selectAll()"></clark-checkbox>
          </div>
          <div role="columnheader">Status</div>
          <div role="columnheader">Name</div>
          <div role="columnheader">Type</div>
          <div role="columnheader">Date</div>
          <div role="columnheader" aria-label="Spacing element for meatball menu"></div>
        </div>
        <div role="rowgroup" >
          <clark-dashboard-item
            *ngFor="let l of learningObjects; let i = index"
            [learningObject]="l"
            [status]="l.status"
            [showCheck]="showOptions"
            [selected]="this.selected.get(l.id) !== undefined"
            (select)="toggleSelect(l, $event, i)"
            (delete)="deleteConfirmation = delete(l); deleteConfirmation.next();"
            (viewAllChangelogs)="openViewAllChangelogsModal(l.id)"
            (viewSidePanel)="openLearningObjectSidePanel(l)"
            >
          </clark-dashboard-item>
        </div>
      </div>
    </div>
</div>

<ng-template #noLearningObjects>
  <div class="dashboard-list__table empty">
    <p *ngIf="filters.size > 1">
      No Learning Objects found for those statuses!
    </p>
    <p *ngIf="filters.size === 1">
      No Learning Objects found for that status!
    </p>
    <p *ngIf="learningObject === 0">
      No {{ title }} Learning Objects!
    </p>
  </div>
</ng-template>

<!-- View All Change Logs -->
<clark-popup [floating]="true" *ngIf="openChangelogModal" (closed)="closeChangelogsModal()">
  <div #popupInner style="min-width: 500px; max-width: 650px;" class="popup-inner">
    <clark-changelog-modal
      [learningObject] = "changelogLearningObject"
      [changelogs] = "changelogs ? changelogs[0] : undefined"
      [loading]="loadingChangelogs  "
    ></clark-changelog-modal>
  </div> 
</clark-popup>

<!-- Delete Confirmation Popup -->
<clark-popup *ngIf="deleteConfirmation" (closed)="deleteConfirmation = undefined">
  <div #popupInner class="popup-inner">
    <div class="modal-title">Are you sure?</div>
    <div class="modal-text">You cannot undo this action!</div>
    <div class="btn-group center">
      <button class="button bad" (click)="deleteConfirmation?.next(true)">Yep, do it! <i class="far fa-trash"></i></button>
      <button class="button neutral" (click)="deleteConfirmation = undefined">Wait, nevermind! <i class="far fa-ban"></i></button>
    </div>
  </div>
</clark-popup>

<!-- Collection Submission Popup 
<clark-submit *ngIf="submitToCollection" [learningObject]="focusedLearningObject" [visible]="true" (close)="submitToCollection = false;"></clark-submit>
-->
<!-- Side panel popout -->
<clark-side-panel-content *ngIf="focusedLearningObject" panel [controller$]="sidePanelController$" [contentWidth]="450" [options]="{ padding: false }" [learningObject]="focusedLearningObject"></clark-side-panel-content>