<div class="dashboard">
  <div [@splash] class="splash">
    <div class="inner">
      <div [@greeting] class="greeting">Good {{ greetingTime }}, <span>{{ auth.user.name.split(' ')[0] }}</span>!</div>
    </div>
  </div>
  <div [@list] class="list-wrapper">
    <div class="list">
      <div #listInner class="list-inner">
        <div class="list-top">
          <header class="header">Your Learning Objects <span *ngIf="editingChildren"> - Editing Children</span></header>
          <div class="btn-group to-right">
            <button *ngIf="!editingChildren" routerLink="/onion/learning-object-builder" class="button good">New <i class="fas fa-plus"></i></button>
            <ng-container *ngIf="!editingChildren">
              <button #filterMenuButtonElement class="button neutral filters-button" [ngClass]="{'shadow': filterMenuDown}" (activate)="toggleFilterMenu(true)"><span tip="Clear filtering criteria" tipPosition="top" *ngIf="filters.size" (activate)="clearFilters(); $event.stopPropagation()"><i class="far fa-times"></i></span> Filter <i class="fas fa-sort"></i></button>
              <!-- Filter Context Menu -->
              <clark-context-menu *ngIf="filterMenuDown" [anchor]="filterMenuButtonElement" [offset]="{ top: 10, left: 5 }" (close)="toggleFilterMenu()">
                <div #contextMenu class="filter-menu">
                  <ul>
                    <li class="unreleased" (activate)="toggleFilter('unreleased')">
                      <div *ngIf="filters.get('unreleased')" class="indicator"></div>
                      <i class="far fa-eye-slash"></i>Unreleased
                    </li>
                    <li class="waiting" (activate)="toggleFilter('waiting')">
                      <div *ngIf="filters.get('waiting')" class="indicator"></div>
                      <i class="far fa-hourglass"></i>Waiting for Review
                    </li>
                    <li class="review" (activate)="toggleFilter('review')">
                      <div *ngIf="filters.get('review')" class="indicator"></div>
                      <i class="far fa-sync"></i>Under Review
                    </li>
                    <li class="proofing" (activate)="toggleFilter('proofing')">
                      <div *ngIf="filters.get('proofing')" class="indicator"></div>
                      <i class="far fa-shield"></i>Proofing
                    </li>
                    <li class="released" (activate)="toggleFilter('released')">
                      <div *ngIf="filters.get('released')" class="indicator"></div>
                      <i class="far fa-eye"></i>Released
                    </li>
                    <li class="denied" (activate)="toggleFilter('rejected')">
                      <div *ngIf="filters.get('rejected')" class="indicator"></div>
                      <i class="far fa-ban"></i>Denied
                    </li>
                  </ul>
                </div>
              </clark-context-menu>
            </ng-container>
            <button *ngIf="!editingChildren && selected.size" class="button bad" (activate)="deleteConfirmation = delete(getSelectedObjects()); deleteConfirmation.next()">Delete Selected <i class="far fa-trash"></i></button>
            <button *ngIf="editingChildren" class="button green" (activate)="childrenConfirmation = finishAddChildren(); childrenConfirmation.next()">Save Children <i class="fas fa-check"></i></button>
            <button *ngIf="editingChildren" class="button bad" (activate)="cancelEditChildren()">Cancel <i class="far fa-ban"></i></button>
          </div>
        </div>
        <div *ngIf="!loading; else loadingTemplate" class="list-body">
          <div *ngIf="learningObjects?.length; else emptyTemplate">
            <div class="column-headers">
              <div>
                <clark-checkbox *ngIf="!editingChildren" [value]="areAllSelected" (action)="selectAll()"></clark-checkbox>
              </div>
              <div>Status</div>
              <div>Name</div>
              <div>Type</div>
              <div>Date</div>
              <div><!-- meatball placeholder --></div>
            </div>
            <div  [@listItem]="learningObjects.length">
              <clark-dashboard-item
                *ngFor="let l of learningObjects; let i = index"
                [learningObject]="l"
                [status]="l.status"
                [disabled]="disabled.get(l.id)"
                [hidden]="hidden.get(l.id)"
                [selected]="this.selected.get(l.id) !== undefined"
                [small]="editingChildren && !this.disabled.get(l.id)"
                [meatball]="!editingChildren"
                (select)="toggleSelect(l, $event, i)"
                (delete)="deleteConfirmation = delete(l); deleteConfirmation.next();"
                (editChildren)="editChildren(l)"
                (submit)="submitToCollection = true; focusedLearningObject = l;"
                (cancelSubmission)="cancelSubmission(l)"
                (viewAllChangelogs)="openViewAllChangelogsModal(l.id)"
                (viewSidePanel)="openLearningObjectSidePanel(l)"
                >
              </clark-dashboard-item>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingTemplate>
  <div [@nonListItem] class="loading-template">
    <i class="far fa-spinner-third fa-spin"></i>
    Loading learning objects...
  </div>
</ng-template>

<ng-template #emptyTemplate>
  <div [@nonListItem] class="empty-template">
    <div class="top">
      <i class="fal fa-box-open"></i>
      <div class="top-message">
        Nothing here!
      </div>
    </div>
    <div class="empty-text">
      Once you've made some learning objects they'll show up here.
    </div>
    <div class="btn-group center">
      <button class="button good" routerLink="/onion/learning-object-builder">Create a Learning Object <i class="fas fa-plus"></i></button>
    </div>
  </div>
</ng-template>


<!-- Delete Confirmation Popup -->
<clark-popup *ngIf="deleteConfirmation" (closed)="deleteConfirmation = undefined">
  <div #popupInner class="popup-inner">
    <div class="modal-title">Are you sure?</div>
    <div class="modal-text">You cannot undo this action!</div>
    <div class="btn-group center">
      <button class="button bad" (activate)="deleteConfirmation?.next(true)">Yep, do it! <i class="far fa-trash"></i></button>
      <button class="button neutral" (activate)="deleteConfirmation = undefined">Wait, nevermind! <i class="far fa-ban"></i></button>
    </div>
  </div>
</clark-popup>

<!-- Children Confirmation Popup -->
<clark-popup *ngIf="childrenConfirmation" (closed)="childrenConfirmation = undefined">
  <div #popupInner class="popup-inner">
    <div class="modal-title">Just to confirm...</div>
      <div class="modal-text">{{ childrenConfirmationMessage }}</div>
      <div class="btn-group center">
        <button class="button good" (activate)="childrenConfirmation?.next(true); childrenConfirmation = undefined;">Yep, do it! <i class="far fa-check"></i></button>
        <button class="button neutral" (activate)="childrenConfirmation = undefined">Wait, nevermind! <i class="far fa-ban"></i></button>
      </div>
  </div>
</clark-popup>

<!-- View All Change Logs -->
<clark-popup [floating]="true" *ngIf="openChangelogModal" (closed)="closeChangelogsModal()">
  <div #popupInner style="min-width: 500px; max-width: 650px;" class="popup-inner">
    <clark-changelog-modal
      [learningObject] = "changelogLearningObject"
      [changelogs] = "changelogs ? changelogs[0] : undefined"
      [loading]="loadingChangelogs  "
    ></clark-changelog-modal>
  </div> 
</clark-popup>

<!-- Collection Submission Popup -->
<clark-submit *ngIf="submitToCollection" [learningObject]="focusedLearningObject" [visible]="true" (close)="submitToCollection = false;"></clark-submit>

<clark-side-panel-content *ngIf="focusedLearningObject" panel [controller$]="sidePanelController$" [contentWidth]="450" [options]="{ padding: false }" [learningObject]="focusedLearningObject"></clark-side-panel-content>
