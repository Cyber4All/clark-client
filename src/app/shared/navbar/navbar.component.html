<clark-message></clark-message>
<ng-container *ngIf="!hideNavbar">
  <app-contextmenu [content]="modalCtrl.contextMenuContent"></app-contextmenu>
  <app-dialogmenu [content]="modalCtrl.dialogMenuContent"></app-dialogmenu>
  <div class="topbar" [ngClass]="{'version': version}">
    <div *ngIf="version" class="version-label">{{version}}</div>
    <div class="inner flex h left-right">
      <div class="spacer" *ngIf="isMobile"></div>
      <div class="logo flex h left-right">
        <div class="left logo-link" routerLink="/home">C.L.A.R.K.
        </div>
        <div class="right">
          Cybersecurity Labs and Resource Knowledge-base
        </div>
      </div>
      <div class="user flex h flex-end" *ngIf="loggedin && !isMobile">

        <div class="left flex h flex-end" (click)="userDropdown($event)">
          <!-- get just first name -->
          <span>Howdy, {{authService.firstName}}!</span>
          <div class="navbar-gravatar" [ngStyle]="{'background-image': 'url(' + gravatarImage(200) + ')'}"></div>
          <div class="chevron">
            <i class="fas fa-caret-down"></i>
          </div>
        </div>

        <div class="right shopping-cart-container" routerLink="/library">
          <div class="library-icon"></div>
          <div *ngIf="cartService.cartItems.length" class="library-badge">{{cartService.cartItems.length}}</div>
        </div>
      </div>

      <div class="user flex h flex-end" *ngIf="!loggedin && !isMobile">
        <div class="login flex h flex-end" routerLink="/auth/login"><div>Sign in</div> <i class="fas fa-sign-in-alt"></i></div>
        <div class="register" routerLink="/auth/register"><div>Register</div> <i class="fas fa-user-plus"></i></div>
      </div>

      <div class="mobile-options" *ngIf="isMobile" >
        <div class="mobile-search-option" (click)="searchDown = true;"><i class="far fa-search"></i></div>
        <div class="hamburger"[ngClass]="{'active': menuOpen}" (click)="menuOpen = !menuOpen">
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
        </div>
      </div>

    </div>
  </div>
  <div *ngIf="!hideNavbar && !isMobile" class="toolbar" [ngClass]="{'onion': isOnion}">
    <div class="content-switch-container">
      <div class="content-switch" [ngClass]="{'right': !isOnion, 'left': isOnion}">
        <div class="options">
          <div class="left contribute" [ngClass]="{'active': isOnion }" (click)="contentSwitchClick($event)" routerLink="/onion">Contribute</div>
          <div class="right search" [ngClass]="{'active': !isOnion }" (click)="contentSwitchClick($event)" routerLink="/home">Search</div>
        </div>
        <div class="highlight"></div>
      </div>
    </div>
    <!-- do NOT change the search-bar class, it's being used in a querySelector in the browse component -->
    <div class="search-bar">
      <form (submit)="performSearch(searchBar)">
        <input #searchBar type="text" placeholder="Search...">
      </form>
      <div class="icon" (click)="performSearch(searchBar)">
        <i class="far fa-search"></i>
      </div>
    </div>
  </div>

  <div class="slideout-underlay" *ngIf="!hideNavbar && isMobile" [ngClass]="{'active': menuOpen || searchDown}" (click)="menuOpen = false; searchDown = false;"></div>
 
  <div class="search-slidedown" *ngIf="!hideNavbar && isMobile" [ngClass]="{'active': searchDown}">
    <form (submit)="performSearch(mobileSearch)">
      <input #mobileSearch name="mobileSearch" placeholder="Search">
    </form>
    <div class="button icon-only good" (click)="performSearch(mobileSearch)"><i class="far fa-search"></i></div>
  </div>
  
  <div class="slideout" *ngIf="!hideNavbar && isMobile" [ngClass]="{'active': menuOpen}">
    <div class="slideout-section user" routerLink="{{ loggedin ? '/users/' + authService.username : '/auth/login' }}">
      <ng-template [ngIf]="loggedin" [ngIfElse]="noUserGreeting">
        <div class="img" [ngStyle]="{'background-image': 'url(' + gravatarImage(200) + ')'}"></div>
        <div class="right">
          <div class="greeting">Howdy, {{ authService.firstName }}!</div>
          <a>View your profile</a>
        </div>
      </ng-template>
      <ng-template #noUserGreeting>
        <div class="greeting">Hi there!<br />We're happy you're here!</div>
      </ng-template>
    </div>
    <div class="slideout-section content-switcher" routerLink="{{ isOnion ? '/home' : '/onion/dashboard' }}">
      <div *ngIf="isOnion; else elseBlock">Search</div>
      <ng-template #elseBlock>Contribute</ng-template>
      <i class="far fa-chevron-right"></i>
    </div>
    <div class="slideout-section menu-items">
      <ul>
        <li *ngIf="loggedin" (click)="logout()">Logout</li>
      </ul>
    </div>
    <div class="slideout-section auth" *ngIf="!loggedin">
      <div class="btn-group vertical">
        <div class="button good" routerLink="/auth/register">Register</div>
        <div class="button neutral on-white" routerLink="/auth/login">Log In</div>
      </div>
    </div>
  </div>
</ng-container>
