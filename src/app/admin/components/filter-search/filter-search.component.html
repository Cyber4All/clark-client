<div class="filter">
  <div class="filter__container">
    <div class="btn-group to-right">
      <ng-container *ngIf="adminOrEditor">
        <button
          class="button neutral filters-button"
          (activate)="toggleRelevancyMenu(true)"
        >
        <span *ngIf="!startNextCheck">Filter By Relevancy Check Dates</span>
        </button>
        <!--CONVERT TO VIRTUAL SCROLLER-->
        <!--This renders the topics list correctly, the list is too long and goes off screen. Zoom screen out to use topics filter-->
        <button 
          #toggleTopicMenuElement
          class="button neutral filters-button"
          (activate)="toggleTopicMenu(true)"
          [ngClass]="{ 'filters-button--down': topicMenuDown }"
        >
          <span class="filter-badge" *ngIf="filterTopics.size">{{ filterTopics.size }}</span>
          Topics
          <i class="fas fa-chevron-down"></i>
        </button>
        <clark-context-menu
          *ngIf="topicMenuDown"
          class="filter-topic"
          [anchor]="toggleTopicMenuElement"
          [offset]="{ top: 10, left: 10 }"
          (close)="toggleTopicMenu()"
        >
          <div #contextMenu class="filter-topic__container">
            <ul>
              <li
                *ngFor="let topic of topics"
                [className]="topic.name"
                (activate)="toggleTopicFilter(topic.name)"
              >
                <div
                  *ngIf="filterTopics.has(topic.name)"
                  class="indicator"
                ></div>
                {{ topic.name | titlecase }}
              </li>
            </ul>
          </div>
        </clark-context-menu>
        <!--END VIRTUAL SCROLLER-->
        <button
          #toggleCollectionMenuElement
          class="button neutral filters-button"
          (activate)="toggleCollectionMenu(true)"
          [ngClass]="{ 'filters-button--down': collectionMenuDown }"
        >
          {{ selectedCollection ? selectedCollection.name : 'All Collections' }}
          <i class="fas fa-chevron-down"></i>
        </button>
        <clark-context-menu
          *ngIf="collectionMenuDown"
          class="filter-collection"
          [anchor]="toggleCollectionMenuElement"
          [offset]="{ top: 10, left: 10 }"
          (close)="toggleCollectionMenu()"
        >
          <div #contextMenu class="filter-collection__container">
            <ul>
              <li
                *ngFor="let collection of collections"
                [className]="collection.abvName"
                (activate)="toggleCollectionFilter(collection.abvName)"
              >
                <div
                  *ngIf="collection.abvName === selectedCollection?.abvName"
                  class="indicator"
                ></div>
                {{ collection.name }}
              </li>
            </ul>
          </div>
        </clark-context-menu>
      </ng-container>
      <ng-container *ngIf="showStatus">
        <button
          #toggleFilterMenuElement
          class="button neutral filters-button"
          (activate)="toggleFilterMenu(true)"
          [ngClass]="{ 'filters-button--down': filterMenuDown }"
        >
          <span class="filter-badge" *ngIf="filters.size">
            {{ filters.size }}
          </span>
          All Statuses <i class="fas fa-chevron-down"></i>
        </button>
        <clark-context-menu
          *ngIf="filterMenuDown"
          class="filter-status"
          [anchor]="toggleFilterMenuElement"
          [offset]="{ top: 10, left: 10 }"
          (close)="toggleFilterMenu(undefined)"
        >
          <div #contextMenu class="filter-status__container">
            <ul>
              <li 
                *ngFor="let status of statuses"
                [ngClass]="status"
                (activate)="toggleStatusFilter(status)">
                  <div *ngIf="filters.has(status)" class="indicator"></div>
                  <i [ngClass]="getStatusIcon(status)"></i> {{ status | titlecase }}
              </li>
            </ul>
          </div>
        </clark-context-menu>
      </ng-container>
      <a
        *ngIf="filters.size || selectedCollection || filterTopics.size"
        (activate)="clearAllFilters()"
        class="filters-clear"
        >Clear filters</a
      >
    </div>
  </div>
</div>


<clark-popup *ngIf="relevancyMenuDown" (closed)="toggleRelevancyMenu(false)">
  <div class="modal-container" #popupInner>
    <div class="modal-title">Filter Learning Objects by Next Check Date</div>
    <div class="modal__inner">
      <mat-form-field class="input">
        <input matInput [matDatepicker]="startPicker" placeholder="Choose a start date" [(ngModel)]="relevancyStart" >
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker startView="year" [startAt]="relevancyStart"></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="input">
        <input matInput [matDatepicker]="endPicker" placeholder="Choose an end date" [(ngModel)]="relevancyEnd" >
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker startView="year" [startAt]="relevancyEnd"></mat-datepicker>
      </mat-form-field>
    </div>
    <div class="btn-group center">
      <button class="button good" (activate)="setDates()">Apply</button>
      <button class="button neutral" (activate)="toggleRelevancyMenu()">Cancel</button>
  </div>
  </div>
</clark-popup>
